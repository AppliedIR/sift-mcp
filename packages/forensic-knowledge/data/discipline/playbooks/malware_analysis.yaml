name: "Malware Analysis Investigation"
description: "Investigation procedure when suspicious executables, documents, or scripts are discovered during forensic triage"
phases:
  - phase: "Detection"
    steps:
      - "Identify the suspicious file through triage (sigcheck unsigned, densityscout high entropy, Prefetch for unknown executable, YARA/CAPA hits, or UNKNOWN in system directory)"
      - "Record the file path, hash, size, and how it was discovered"
      - "Check the file hash against threat intelligence (opencti: lookup_hash)"
      - "Check the file against Windows baseline (windows-triage: check_file)"
      - "Do not conclude malicious based on UNKNOWN status alone — UNKNOWN means not in the baseline database"
  - phase: "Context Collection"
    steps:
      - "Check Prefetch for execution evidence (PECmd) — note execution count and timestamps"
      - "Check Amcache for installation/presence records (AmcacheParser)"
      - "Check ShimCache for execution evidence (AppCompatCacheParser)"
      - "Check autorun entries for persistence (autorunsc, RECmd, check_autorun)"
      - "Check parent-child process relationships if process data is available (check_process_tree)"
      - "Check for related files in the same directory or created around the same time (MFTECmd timeline)"
      - "Record all context as timeline events before proceeding to analysis"
  - phase: "Static Analysis"
    steps:
      - "Submit file to REMnux for analysis (remnux: analyze_file with depth standard)"
      - "Review CAPA capabilities identified — note behavioral indicators"
      - "Review strings and embedded IOCs extracted by REMnux"
      - "If the file is a document (Office, PDF), check for macros, embedded objects, and exploits"
      - "If packed or encrypted, use deep analysis (remnux: analyze_file with depth deep)"
      - "Cross-reference extracted IOCs with threat intelligence (opencti: lookup_ioc)"
      - "Search forensic-rag for related techniques or malware families"
  - phase: "Scope Assessment"
    steps:
      - "Search for the file hash across all systems in scope"
      - "Check for lateral movement indicators if the file appears on multiple systems"
      - "Identify the delivery mechanism (email attachment, web download, SMB transfer, USB)"
      - "Map the timeline from delivery to execution to persistence"
      - "Identify all accounts and systems that interacted with the file"
  - phase: "Findings"
    steps:
      - "Record finding with evidence IDs from all analysis steps"
      - "Include the REMnux analysis evidence_id alongside triage evidence"
      - "State what the file does based on evidence, not what it might do"
      - "If attribution is possible, stage as DRAFT and stop at HITL checkpoint"
      - "Include IOCs for detection and blocking"
